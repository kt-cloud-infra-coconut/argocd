apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - namespace.yml
  - login/myweb-svc-deploy-login.yml
  - edit/myweb-svc-deploy-edit.yml
  - regist/myweb-svc-deploy-regist.yml
  - myweb-ingress-rule.yml
  # NodePort 서비스 추가
  # - ingress-myweb-svc.yml  # 파일이 존재하지 않아 주석 처리
  # 공식 Ingress Controller 원본 리소스 (필수)
  # - https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.14.0/deploy/static/provider/cloud/deploy.yaml

# Admission Webhook 관련 Job 제외 (ArgoCD sync 문제 해결)
patches:
  - target:
      kind: Job
    patch: |-
      $patch: delete
  - target:
      kind: ValidatingWebhookConfiguration
    patch: |-
      $patch: delete

configMapGenerator:
  - name: login-html
    files:
      - index.html=login/index.html

  - name: edit-html
    files:
      - index.html=edit/index.html

  - name: regist-html
    files:
      - index.html=regist/index.html

generatorOptions:
  disableNameSuffixHash: true
